sp {sorting*propose*create-topstate-history
   (state <s> ^name sort-blocks
              ^top-state <ts>)
   (<ts> -^block-history)
-->
   (<s> ^operator <o> + =)
   (<o> ^name create-topstate-history)
}

sp {sorting*apply*create-topstate-history
   (state <s> ^name sort-blocks
              ^top-state <ts>
              ^operator.name create-topstate-history)
-->
   (<ts> ^block-history <h>)
}

sp {sorting*propose*move-block*blue
   (state <s> ^name sort-blocks
              ^top-state <ts>)
   (<ts> ^world.objects <objs>
         ^block-history <h>)
   (<objs> ^object <ob1>
           ^object <ob2>)
   (<ob1> ^item-type object
         ^predicates <preds>
         ^handle <id>)
   (<preds> ^category block
            ^color blue1)
   (<ob2> ^item-type object
         ^predicates <preds2>
         ^handle <loc>)
   (<preds2> ^category location
            ^color green1)
-->
   (<s> ^operator <o> + =)
   (<o> ^name move-block
        ^block <ob1>
        ^location <ob2>)
   (interrupt)
}

sp {sorting*propose*move-block*red
   (state <s> ^name sort-blocks
              ^top-state <ts>)
   (<ts> ^world.objects <objs>
         ^block-history <h>)
   (<objs> ^object <ob1>
           ^object <ob2>)
   (<ob1> ^item-type object
         ^predicates <preds>
         ^handle <id>)
   (<preds> ^category block
            ^color red1)
   (<ob2> ^item-type object
         ^predicates <preds2>
         ^handle <loc>)
   (<preds2> ^category location
            ^color yellow1)
-->
   (<s> ^operator <o> + =)
   (<o> ^name move-block
        ^block <ob1>
        ^location <ob2>)
   (interrupt)
}

sp {sorting*reject*move-block*already-on-location
	(state <s> ^name sort-blocks
               ^operator <o> +
               ^top-state <ts>)
 	(<o> ^name move-block
         ^block <b>
         ^location <loc>)
    (<ts> ^world.predicates <preds>)
    (<preds> ^predicate <p>)
    (<p> ^handle on1
         ^instance <i>)
    (<i> ^1 <b>
         ^2 <loc>)
-->
	(<s> ^operator <o> -)
}